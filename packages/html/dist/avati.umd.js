!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["@avati/html"]=e():t["@avati/html"]=e()}(self,(function(){return function(){"use strict";var t,e={d:function(t,n){for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r:function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};e.r(n),e.d(n,{BatchScheduler:function(){return s},Component:function(){return c},ComponentWithRefs:function(){return u},ComputedSignal:function(){return f},Fragment:function(){return S},HooksContext:function(){return a},Reconciler:function(){return h},Signal:function(){return d},batch:function(){return _},batchUpdates:function(){return o},cloneElement:function(){return I},computed:function(){return y},createElement:function(){return k},createRoot:function(){return p},createSignal:function(){return m},createTextNode:function(){return U},effect:function(){return g},isClassComponent:function(){return O},isForwardRef:function(){return w},isFunctionComponent:function(){return E},isVElement:function(){return j},jsx:function(){return v},jsxs:function(){return C},useCallbackRef:function(){return D},useEffect:function(){return T},useRef:function(){return M},useState:function(){return N},withHooks:function(){return l}});class s{constructor(){this.queue=new Set,this.isBatching=!1,this.isScheduled=!1,this.batchDepth=0,this.taskQueue=[]}static getInstance(){return s.instance||(s.instance=new s),s.instance}schedule(t,e="normal"){"high"===e?this.taskQueue.unshift(t):this.taskQueue.push(t),this.isScheduled||(this.isScheduled=!0,queueMicrotask((()=>this.processQueue())))}processQueue(){if(this.batchDepth>0)return;const t=[...this.taskQueue];this.taskQueue=[],this.isScheduled=!1;try{this.isBatching=!0,t.forEach((t=>{try{t()}catch(t){console.error("Error in batched task:",t)}}))}finally{this.isBatching=!1,this.taskQueue.length>0&&this.schedule((()=>this.processQueue()))}}startBatch(){this.batchDepth++}endBatch(){this.batchDepth--,0===this.batchDepth&&this.processQueue()}}function o(t){const e=s.getInstance();e.startBatch();try{return t()}finally{e.endBatch()}}class r{constructor(t){this.props=Object.freeze(Object.assign({},t)),this.state=Object.freeze({})}}r.isReactComponent=!0,function(t){t.UNMOUNTED="UNMOUNTED",t.MOUNTING="MOUNTING",t.MOUNTED="MOUNTED",t.UPDATING="UPDATING",t.UNMOUNTING="UNMOUNTING"}(t||(t={}));class i{static registerRef(t,e){this.refs.has(t)||this.refs.set(t,new Set),this.refs.get(t).add(e)}static unregisterRef(t,e){const n=this.refs.get(t);n&&n.delete(e)}static clearRefs(t){const e=this.refs.get(t);e&&(e.forEach((t=>{"function"==typeof t?t(null):t&&(t.current=null)})),this.refs.delete(t))}static attachRef(t,e){t&&("function"==typeof t?t(e):t.current=e)}}i.refs=new WeakMap;class c{constructor(e){this._lifecycleState=t.UNMOUNTED,this._pendingState=[],this._isBatchingUpdates=!1,this._contextUnsubscribe=null,this._signals=null,this._owner=null,this._internalInstance=null,this.props=Object.freeze(Object.assign({},e)),this.state=Object.freeze({})}setState(t,e){const n="function"==typeof t?t(this.state,this.props):t;this._pendingState.push(n),this._isBatchingUpdates||(this._flushPendingState(),null==e||e())}forceUpdate(){this._lifecycleState===t.MOUNTED&&this._performUpdate()}_handleMount(){var e;this._lifecycleState===t.UNMOUNTED&&(this._lifecycleState=t.MOUNTING,null===(e=this.componentDidMount)||void 0===e||e.call(this),this._lifecycleState=t.MOUNTED)}_handleUnmount(){var e,n;this._lifecycleState===t.MOUNTED&&(this._lifecycleState=t.UNMOUNTING,this._contextUnsubscribe&&(this._contextUnsubscribe(),this._contextUnsubscribe=null),null===(e=this.componentWillUnmount)||void 0===e||e.call(this),null===(n=this._signals)||void 0===n||n.clear(),this._lifecycleState=t.UNMOUNTED)}_flushPendingState(){if(0===this._pendingState.length)return;const e=this.state,n=this._pendingState.reduce(((t,e)=>Object.assign(Object.assign({},t),e)),this.state);this._pendingState=[],this.state=Object.freeze(n),this._lifecycleState===t.MOUNTED&&this._performUpdate(e)}_performUpdate(e){var n,s,o;this._lifecycleState=t.UPDATING;const r=this.props;if(null===(s=null===(n=this.shouldComponentUpdate)||void 0===n?void 0:n.call(this,this.props,this.state))||void 0===s||s){this.render();null===(o=this.componentDidUpdate)||void 0===o||o.call(this,r,e||this.state)}this._lifecycleState=t.MOUNTED}_startBatch(){this._isBatchingUpdates=!0}_endBatch(){this._isBatchingUpdates=!1,this._flushPendingState()}static get current(){return c._currentInstance}static set current(t){c._currentInstance=t}}c._currentInstance=null;class u extends c{constructor(){super(...arguments),this._refCallbacks=new Set}registerRefCallback(t){this._refCallbacks.add(t)}componentWillUnmount(){this._refCallbacks.forEach((t=>t())),this._refCallbacks.clear(),i.clearRefs(this)}}class a{constructor(){this.currentComponent=null,this.hookStates=new WeakMap,this.updateScheduled=new WeakSet}static getInstance(){return a.instance||(a.instance=new a),a.instance}beginRender(t){this.currentComponent||(this.currentComponent=t,t._currentHookIndex=0,this.hookStates.has(t)||this.hookStates.set(t,[]),t._refs||(t._refs=new Set))}endRender(){if(this.currentComponent){const t=this.hookStates.get(this.currentComponent);t&&t.length!==this.currentComponent._currentHookIndex&&console.warn("Hook count mismatch: possible conditional hook usage",{expected:t.length,actual:this.currentComponent._currentHookIndex})}this.currentComponent=null}getHookState(t){if(!this.currentComponent)throw new Error("Hook called outside of component render");const e=this.hookStates.get(this.currentComponent),n=this.currentComponent._currentHookIndex++;if(n>=e.length){const n=Object.assign({},t);return e.push(n),n}return e[n]}scheduleUpdate(t){this.updateScheduled.has(t)||(this.updateScheduled.add(t),queueMicrotask((()=>{this.updateScheduled.has(t)&&t._mounted&&(this.updateScheduled.delete(t),t.setState({}))})))}registerRef(t){this.currentComponent&&this.currentComponent._refs.add(t)}runEffects(t){const e=this.hookStates.get(t);e&&e.forEach(((t,e)=>{if("effect"===t.type){const e=t;e.effect&&(e.cleanup&&e.cleanup(),e.cleanup=e.effect()||void 0)}}))}updateEffects(t){const e=this.hookStates.get(t);e&&e.forEach(((t,e)=>{if("effect"===t.type){const e=t;e.deps&&!e.depsChanged||(e.cleanup&&e.cleanup(),e.cleanup=e.effect()||void 0,e.depsChanged=!1)}}))}cleanup(t){const e=this.hookStates.get(t);e&&(e.forEach((t=>{"effect"===t.type&&t.cleanup&&t.cleanup()})),this.hookStates.delete(t)),this.updateScheduled.delete(t)}}function l(t){return function(e){if(!this)return t.call(void 0,e);const n=a.getInstance();this._hooks||(this._hooks=[],this._currentHookIndex=0,this._mounted=!1,this._refs=new Set,this.componentWillUnmount=()=>{a.getInstance().cleanup(this),this._mounted=!1}),n.beginRender(this);try{return t.call(void 0,e)}finally{n.endRender()}}}class h{constructor(){this.rootInstance=null,this.pendingUpdates=new Set,this.isProcessingUpdates=!1}static getInstance(){return h.instance||(h.instance=new h),h.instance}mount(t,e){try{const n=this.rootInstance,s=this.reconcile(e,n,t);this.rootInstance=s,this.processPendingUpdates()}catch(t){throw console.error("Error during mount:",t),t}}unmount(){this.rootInstance&&(this.unmountInstance(this.rootInstance),this.rootInstance=null)}reconcile(t,e,n){try{if(!n)return e&&this.unmountInstance(e),null;if("string"==typeof n||"number"==typeof n)return this.reconcileText(t,e,String(n));if("boolean"==typeof n||null===n)return null;Array.isArray(n)&&(n={type:"fragment",props:{children:n},key:null,ref:null});const{type:s}=n;return"string"==typeof s?this.reconcileDOMComponent(t,e,n):"function"==typeof s?this.isClassComponent(s)?this.reconcileClassComponent(t,e,n):this.reconcileFunctionComponent(t,e,n):(console.error("Unknown element type:",s),null)}catch(t){throw console.error("Error during reconciliation:",t),t}}reconcileText(t,e,n){if(e&&"TEXT_ELEMENT"===e.type)return e.dom.nodeValue=n,e;const s=document.createTextNode(n),o={type:"TEXT_ELEMENT",dom:s,vnode:n,parent:null,key:null,childInstances:new Map};return this.replaceNode(t,s,null==e?void 0:e.dom),o}reconcileDOMComponent(t,e,n){if(e&&e.type===n.type)return this.updateDOMProperties(e.dom,e.vnode.props,n.props),e.vnode=n,e.childInstances=this.reconcileChildren(e,n),e;const s=document.createElement(n.type),o={type:n.type,dom:s,vnode:n,parent:null,key:n.key,childInstances:new Map};return this.updateDOMProperties(s,{},n.props),o.childInstances=this.reconcileChildren(o,n),this.replaceNode(t,s,null==e?void 0:e.dom),o}reconcileClassComponent(t,e,n){var s,o,r,i,c;let u,a=null;if(e&&e.type===n.type){u=e.component;const i=u.props;if(u.props=n.props,null===(o=null===(s=u.shouldComponentUpdate)||void 0===s?void 0:s.call(u,n.props,u.state))||void 0===o||o){const n=u.render(),s=this.reconcile(t,e.childInstances.get("0"),n);s&&(e.childInstances.set("0",s),a=s.dom),null===(r=u.componentDidUpdate)||void 0===r||r.call(u,i,u.state)}else a=e.dom;return e.dom=a,e.vnode=n,e}e&&this.unmountInstance(e),u=new n.type(n.props);const l=u.render(),h=this.reconcile(t,null,l),p={type:n.type,dom:null!==(i=null==h?void 0:h.dom)&&void 0!==i?i:null,vnode:n,component:u,parent:null,key:n.key,childInstances:new Map};return h&&(p.childInstances.set("0",h),h.parent=p),null===(c=u.componentDidMount)||void 0===c||c.call(u),p}reconcileFunctionComponent(t,e,n){var s,o;const r=n.type;let i;if(e&&e.type===r)i=e.component,i.props=n.props;else{const t=l(r),e=this;i=new class{constructor(){this._instanceId=Symbol("function-component"),this.props=n.props,this._hooks=[],this._currentHookIndex=0,this._mounted=!1,this.setState=t=>{e.scheduleUpdate(i)},this.render=t}}}const c=a.getInstance();c.beginRender(i);try{const c=i.render(n.props),u=this.reconcile(t,null!==(s=null==e?void 0:e.childInstances.get("0"))&&void 0!==s?s:null,c),l={type:r,dom:null!==(o=null==u?void 0:u.dom)&&void 0!==o?o:null,vnode:n,component:i,parent:null,key:n.key,childInstances:new Map};return u&&(l.childInstances.set("0",u),u.parent=l),i._mounted?queueMicrotask((()=>{i._mounted&&a.getInstance().updateEffects(i)})):(i._mounted=!0,queueMicrotask((()=>{i._mounted&&a.getInstance().runEffects(i)}))),l}finally{c.endRender()}}reconcileChildren(t,e){const n=t.dom,s=t.childInstances,o=this.normalizeChildren(e.props.children),r=new Map,i=new Map;s.forEach(((t,e)=>{var n;const s=null!==(n=t.key)&&void 0!==n?n:e;i.set(s,t)}));let c=null;return o.forEach(((e,s)=>{const o=this.getKey(e,s),u=i.get(o),a=this.reconcile(n,u,e);a&&(r.set(o,a),a.parent=t,a.dom&&(c&&a.dom!==c.nextSibling&&n.insertBefore(a.dom,c.nextSibling),c=a.dom))})),s.forEach(((t,e)=>{r.has(e)||this.unmountInstance(t)})),r}updateDOMProperties(t,e,n){const s=t=>t.startsWith("on"),o=t=>!s(t)&&"children"!==t&&"ref"!==t;Object.keys(e).filter(s).forEach((n=>{const s=n.toLowerCase().substring(2);t.removeEventListener(s,e[n])})),Object.keys(e).filter(o).forEach((e=>{t.removeAttribute(e)})),e.ref&&this.handleRef(e.ref,null),Object.keys(n).filter(s).forEach((e=>{const s=e.toLowerCase().substring(2);t.addEventListener(s,n[e])})),Object.keys(n).filter(o).forEach((e=>{const s=n[e];null!=s&&("className"===e?t.setAttribute("class",s):"style"===e&&"object"==typeof s?Object.assign(t.style,s):t.setAttribute(e,s.toString()))})),n.ref&&this.handleRef(n.ref,t)}unmountInstance(t){var e;if(this.isFunctionComponent(t)){const e=t.component;e._mounted=!1,a.getInstance().cleanup(e)}t.childInstances.forEach((t=>{this.unmountInstance(t)})),(null===(e=t.dom)||void 0===e?void 0:e.parentNode)&&t.dom.parentNode.removeChild(t.dom),t.unsubscribe&&t.unsubscribe()}scheduleUpdate(t){this.isProcessingUpdates?this.pendingUpdates.add(t):(this.isProcessingUpdates=!0,queueMicrotask((()=>{try{this.processUpdate(t)}finally{if(this.isProcessingUpdates=!1,this.pendingUpdates.size>0){const t=Array.from(this.pendingUpdates);this.pendingUpdates.clear(),t.forEach((t=>this.scheduleUpdate(t)))}}})))}processUpdate(t){var e;const n=this.findInstanceByComponent(t);if(!n||!(null===(e=n.dom)||void 0===e?void 0:e.parentElement))return;const s=n.dom.parentElement,o=n.vnode,r=Object.assign(Object.assign({},o),{props:t.props}),i=this.reconcile(s,n,r);n===this.rootInstance&&(this.rootInstance=i)}processPendingUpdates(){if(console.log("process update"),!this.isProcessingUpdates){this.isProcessingUpdates=!0;try{for(;this.pendingUpdates.size>0;){const t=Array.from(this.pendingUpdates);this.pendingUpdates.clear();for(const e of t)this.updateInstance(e)}}finally{this.isProcessingUpdates=!1}}}updateInstance(t){var e;const n=null===(e=t.dom)||void 0===e?void 0:e.parentElement;if(!n)return;const s=t.vnode,o=Object.assign(Object.assign({},s),{props:Object.assign(Object.assign({},s.props),{children:s.props.children})});this.reconcile(n,t,o)}findInstanceByComponent(t){const e=n=>{if(!n)return null;if("component"in n&&n.component===t)return n;for(const t of n.childInstances.values()){const n=e(t);if(n)return n}return null};return e(this.rootInstance)}isClassComponent(t){return t.prototype instanceof r}getKey(t,e){var n;return t&&"string"!=typeof t&&"number"!=typeof t&&null!==(n=t.key)&&void 0!==n?n:e.toString()}normalizeChildren(t){return t?Array.isArray(t)?t.flat():[t]:[]}replaceNode(t,e,n){n&&n.parentNode===t?t.replaceChild(e,n):t.appendChild(e)}handleRef(t,e){"function"==typeof t?t(e):t&&"object"==typeof t&&"current"in t&&(t.current=e)}isFunctionComponent(t){return"function"==typeof t.type&&!(t.type.prototype instanceof r)}}function p(t){let e=null;return{render(n){e=n,s.getInstance().schedule((()=>{h.getInstance().mount(e,t)}))},unmount(){e&&(s.getInstance().schedule((()=>{h.getInstance().unmount()})),e=null)}}}class d{constructor(t,e={}){this._version=0,this._subscribers=new Set,this._computedSubscribers=new Set,this._value=t,this._equals=e.equals||((t,e)=>Object.is(t,e))}get subscribers(){return this._subscribers}unsubscribe(t){throw new Error("Method not implemented.")}emit(t){throw new Error("Method not implemented.")}get value(){return d._trackSignal(this),this._value}set value(t){this._equals(this._value,t)||(this._value=t,this._version++,this._notify())}update(t){const e=t(this._value);this._equals(this._value,e)||(this._value=e,this._version++,this._notify())}subscribe(t){return this._subscribers.add(t),()=>{this._subscribers.delete(t)}}_subscribeComputed(t){this._computedSubscribers.add(t)}_unsubscribeComputed(t){this._computedSubscribers.delete(t)}_notify(){for(const t of this._computedSubscribers)t._recompute();for(const t of this._subscribers)t()}static _trackSignal(t){this._currentComputation&&t._subscribeComputed(this._currentComputation)}static _setCurrentComputation(t){this._currentComputation=t}}d._currentComputation=null;class f extends d{constructor(t){super(void 0),this._dependencies=new Set,this._dirty=!0,this._compute=t}get value(){return this._dirty&&this._recompute(),super.value}set value(t){throw new Error("Cannot set the value of a computed signal directly")}_recompute(){for(const t of this._dependencies)t._unsubscribeComputed(this);this._dependencies.clear(),d._setCurrentComputation(this);try{const t=this._compute();this._equals(this._value,t)||(this._value=t,this._notify())}finally{d._setCurrentComputation(null)}this._dirty=!1}_markDirty(){this._dirty=!0;for(const t of this._computedSubscribers)t._markDirty();for(const t of this._subscribers)t()}}function m(t,e){return new d(t,e)}function y(t){return new f(t)}function g(t){let e;return y((()=>{e&&e(),e=t()})).value,()=>{e&&e()}}function _(t){const e=d._currentComputation;d._setCurrentComputation(null);try{t()}finally{d._setCurrentComputation(e)}}var b=function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(n[s[o]]=t[s[o]])}return n};function v(t,e,n){var s,o;e=e||{};const{children:r}=e,i=b(e,["children"]);return{type:t,props:Object.assign(Object.assign({},i),{children:null!=r?r:[]}),key:null!==(s=null!=n?n:e.key)&&void 0!==s?s:null,ref:null!==(o=e.ref)&&void 0!==o?o:null}}function C(t,e,n){return v(t,e,n)}function S(t){return{type:Symbol.for("react.fragment"),props:{children:t.children||[]},key:null,ref:null}}function k(t,e,...n){var s,o;e=e||{};const r=n.flat().filter((t=>null!=t&&!1!==t));return{type:t,props:Object.assign(Object.assign({},e),{children:0===r.length?e.children||[]:r}),key:null!==(s=e.key)&&void 0!==s?s:null,ref:null!==(o=e.ref)&&void 0!==o?o:null}}function U(t){return String(t)}function I(t,e,...n){var s,o;return{type:t.type,props:Object.assign(Object.assign(Object.assign({},t.props),e),{children:n.length>0?n:t.props.children}),key:null!==(s=e&&e.key)&&void 0!==s?s:t.key,ref:null!==(o=e&&e.ref)&&void 0!==o?o:t.ref}}function O(t){var e;return Boolean(null===(e=null==t?void 0:t.prototype)||void 0===e?void 0:e.isReactComponent)}function E(t){var e;return"function"==typeof t&&!(null===(e=t.prototype)||void 0===e?void 0:e.isReactComponent)}function w(t){return Boolean(null==t?void 0:t.__forwarded)}function j(t){return t&&"object"==typeof t&&"type"in t&&"props"in t}function N(t){const e=a.getInstance(),n=e.getHookState({value:"function"==typeof t?t():t,type:"state"}),s=e.currentComponent;return[n.value,t=>{const o="function"==typeof t?t(n.value):t;Object.is(o,n.value)||(n.value=o,s._mounted&&e.scheduleUpdate(s))}]}function M(t=null){const e=a.getInstance(),n=e.getHookState({value:{current:t},type:"ref"});return e.registerRef(n.value),n.value}function T(t,e){const n=a.getInstance().getHookState({type:"effect",effect:t,deps:e,depsChanged:!0});if(e){const t=n.deps;n.deps=e,n.depsChanged=!t||t.length!==e.length||e.some(((e,n)=>e!==t[n]))}else n.depsChanged=!0;n.effect=t}function D(t){const e=M(null),n=M(t);return n.current=t,{get current(){return e.current},set current(t){e.current=t,n.current(t)}}}return n}()}));